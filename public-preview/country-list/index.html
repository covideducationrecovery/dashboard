---
---
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    {% if site.safe == true %}
    <script src="/js/vue.min.js" type="text/javascript"></script>
    <script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link href="/css/all.min.css" rel="stylesheet">
    {% else %}
    <script src="/js/vue.js" type="text/javascript"></script>
    <script src="/js/bootstrap.bundle.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link href="/css/all.css" rel="stylesheet">
    {% endif %}
    <title>Global Survey Response Dashboard</title>
    <style>
      [v-cloak] {display: none;}
    </style>
    <script type="text/javascript">
      {% include utils.js %}
    </script>
  </head>
  <body>
    {% include navbar-preview.html %}

    <div id="vue-app" class="container-fluid" v-cloak>
      <h1>Country Statistics</h1>
      <table class="table table-sm table-hover">
        <thead>
          <tr>
            <th>Country</th>
            <th>World Bank Region</th>
            <th>Education Status</th>
            <th>Education Modality</th>
            <th>Teacher Vaccinations Prioritized</th>
            <th>Vaccines Authorized <span class="badge bg-secondary rounded-pill" style="opacity: 0.5" title="Courtesy of Our World In Data"><i class="fas fa-info"></i></span></th>
            <th>In-Person Education Supports</th>
            <th>Remote Education Supports</th>
            <th>Last Updated</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="country of countries" v-if="country.fields.mostRecentResponseDate">
            <td>${ country.fields.countryName}</td>
            <td>${ country.fields.wbRegion}</td>
            <td>
              <span class="badge bg-success" v-if="country.fields.mostRecentEducationStatusCode && (country.fields.mostRecentEducationStatusCode.includes('2') || country.fields.mostRecentEducationStatusCode.includes('3') || country.fields.mostRecentEducationStatusCode.includes('4'))" title="Education services available"><i class="fas fa-check"></i></span>
              <span class="badge bg-secondary" v-else-if="country.fields.mostRecentExtendedBreakCode && country.fields.mostRecentExtendedBreakCode.includes('1')" title="On extended break"><i class="fas fa-umbrella-beach"></i></span>
              <span class="badge bg-danger" v-else-if="country.fields.mostRecentEducationStatusCode && country.fields.mostRecentEducationStatusCode.includes('1')" title="Education services unavailable"><i class="fas fa-times"></i></span>
            </td>
            <td v-if="country.fields.mostRecentEducationStatusCode">
              <span class="badge bg-danger" v-if="country.fields.mostRecentEducationStatusCode.includes('1')" title="No education services"><i class="fas fa-times"></i></span>
              <span class="badge bg-secondary" v-if="country.fields.mostRecentEducationStatusCode.includes('2')" title="Remote"><i class="fas fa-home"></i></span>
              <span class="badge bg-info" v-if="country.fields.mostRecentEducationStatusCode.includes('3')" title="Hybrid"><i class="fas fa-school"></i> + <i class="fas fa-home"></i></span>
              <span class="badge bg-dark" v-if="country.fields.mostRecentEducationStatusCode.includes('4')" title="In-person"><i class="fas fa-school"></i></span>
              <span class="badge bg-warning" v-if="country.fields.mostRecentEducationStatusCode.includes('5')" title="Other">Other</span>
            </td>
            <td v-else></td>
            <td v-if="country.fields.mostRecentVaccineAvailabilityForTeachersCode">
              <span class="badge bg-success" v-if="country.fields.mostRecentVaccineAvailabilityForTeachersCode.includes('1')" title="Yes"><i class="fas fa-check"></i></span>
              <span class="badge bg-danger" v-if="country.fields.mostRecentVaccineAvailabilityForTeachersCode.includes('2')" title="No"><i class="fas fa-times"></i></span>
              <span class="badge bg-info" v-if="country.fields.mostRecentVaccineAvailabilityForTeachersCode.includes('3')">Other</span>
              <span class="badge bg-secondary" v-if="country.fields.mostRecentVaccineAvailabilityForTeachersCode.includes('4')">Unknown</span>
            </td>
            <td v-else></td>
            <td>
              <span v-if="country.fields.owidHasVaccine" class="badge bg-success text-center"><i class="fas fa-check"></i></span>
            </td>
            <td>
              <table>
                <tr v-for="field in mostRecentInPersonAdditionalSupportFields" v-if="country.fields[field.name] && !country.fields[field.name].includes('7') && !country.fields[field.name].includes('8')">
                  <td><small class="text-muted">${field.text}</small></td>
                  <td><span class="badge bg-info mx-1" v-for="supportType in mostRecentInPersonAdditionalSupportTypes" v-if="country.fields[field.name].includes(supportType.value)" v-bind:title="supportType.title"><i v-bind:class="'fas fa-' + supportType.faIcon"></i></span></td>
                </tr>
              </table>
            </td>
            <td>
              <table>
                <tr v-for="field in mostRecentRemoteEducationModalityFields" v-if="country.fields[field.name] && !country.fields[field.name].includes('6') && !country.fields[field.name].includes('7')">
                  <td><small class="text-muted">${field.text}</small></td>
                  <td><span class="badge bg-info mx-1" v-for="modalityType in mostRecentRemoteEducationModalityTypes" v-if="country.fields[field.name].includes(modalityType.value)" v-bind:title="modalityType.title"><i v-bind:class="'fas fa-' + modalityType.faIcon"></i></span></td>
                </tr>  
              </table>
            </td>
            <td>${ country.fields.mostRecentResponseDate | iso8601ToLocaleDateString }</td>
          </tr>
        </tbody>
      </table>
    </div>


    <script>

      const mostRecentInPersonAdditionalSupportFields = [
        {name: 'mostRecentInPersonAdditionalSupportPrePrimary', text: 'Pre-Primary'},
        {name: 'mostRecentInPersonAdditionalSupportPrimary', text: 'Primary'},
        {name: 'mostRecentInPersonAdditionalSupportLowerSecondary', text: 'Lower Secondary'},
        {name: 'mostRecentInPersonAdditionalSupportUpperSecondary', text: 'Upper Secondary'}
      ]
      const mostRecentInPersonAdditionalSupportTypes = [
        {value: '1', title: 'School Day Changes', faIcon: 'calendar-day'},
        {value: '2', title: 'School Year Changes', faIcon: 'calendar-alt'},
        {value: '3', title: 'Teacher Tutoring', faIcon: 'school'},
        {value: '4', title: 'Non-Teacher Tutoring', faIcon: 'home'},
        {value: '5', title: 'Targeted Remedial Measures', faIcon: 'bullseye'},
        {value: '6', title: 'Other', faIcon: 'question'}
      ]
      const mostRecentRemoteEducationModalityFields = [
        {name: 'mostRecentRemoteEducationModalitiesPrePrimaryCode', text: 'Pre-Primary'},
        {name: 'mostRecentRemoteEducationModalitiesPrimaryCode', text: 'Primary'},
        {name: 'mostRecentRemoteEducationModalitiesLowerSecondaryCode', text: 'Lower Secondary'},
        {name: 'mostRecentRemoteEducationModalitiesUpperSecondaryCode', text: 'Upper Secondary'},
        {name: 'mostRecentRemoteEducationModalitiesHigherCode', text: 'Higher Education'},
        {name: 'mostRecentRemoteEducationModalitiesVocationalCode', text: 'Technical/Vocational'}
      ]
      const mostRecentRemoteEducationModalityTypes = [
        {value: '1', title: 'Online platforms', faIcon: 'globe'},
        {value: '2', title: 'Television', faIcon: 'tv'},
        {value: '3', title: 'Radio', faIcon: 'broadcast-tower'},
        {value: '4', title: 'Mobile devices', faIcon: 'mobile'},
        {value: '5', title: 'Take-home packages', faIcon: 'paperclip'},
        {value: '8', title: 'Tutoring', faIcon: 'chalkboard-teacher'}
      ]
      const prepareCountriesData = (countries) => {
        countries.sort((country1, country2) => {
          return country1.fields.countryName.localeCompare(country2.fields.countryName)
        });
        return countries
      }

      const renderData = (data) => {
        vm = new Vue({
          el: '#vue-app',
          data: {
            countries: prepareCountriesData(data),
            mostRecentInPersonAdditionalSupportFields: mostRecentInPersonAdditionalSupportFields,
            mostRecentInPersonAdditionalSupportTypes: mostRecentInPersonAdditionalSupportTypes,
            mostRecentRemoteEducationModalityFields: mostRecentRemoteEducationModalityFields,
            mostRecentRemoteEducationModalityTypes: mostRecentRemoteEducationModalityTypes
          },
          delimiters: ['${','}'],  // need to use these because jekyll competes for {{ and }}
          filters: {
            iso8601ToLocaleDateString: (value) => {
              if (value) {
                return (new Date(value)).toLocaleDateString();
              } else {
                return null
              }
            }
          }
        });
      }

      // if we have a token, use it to call the api, otherwise redirect to login screen
      const dataSource = 'https://jhu-education-dashboard-beta.herokuapp.com/countries';
      if (JwtManager.token) {
        fetch(dataSource, {headers: {'Authorization': `Bearer ${JwtManager.token}`}})
          .then(response => {
            switch (response.status) {
              case 200:
                // huzzah we have the data
                response.json().then(data => renderData(data));
                break;
              case 403: 
                // denied because of invalid token
                window.location = '/login';
                break;
              default:
            }
          })
          .catch(error => {
            document.getElementById(`loading`).innerText = "Error loading the data. We apologize for the inconvenience; please try again later.";
            console.error(error);
          })
      } else {
        window.location = '/login';
      }
    </script>
  </body>
</html>